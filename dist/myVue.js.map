{"version":3,"file":"myVue.js","sources":["../src/demo.js"],"sourcesContent":["export default class myVue {\n    constructor(options) {\n        this.$el = this.getElement(options.el)\n        this.template = this.$el.innerHTML\n        this.data = options.data\n        this.activeMethods(options.methods)\n        this.reactive(options.data)\n        this.render()\n    }\n\n    // 激活函数\n    activeMethods(methods) {\n        for (const key in methods) {\n            // 绑定this指向\n            this[key] = methods[key].bind(this)\n        }\n    }\n\n    getElement(name) {\n        // 目前只考虑id\n        if (name.includes('#')) {\n            return document.getElementById(name.slice(1, name.length))\n        }\n    }\n\n    reactive(data) {\n        for (const key in data) {\n            this[key] = this.def(data[key])\n        }\n    }\n\n    // 检查是否已经进行ref\n    checkIfRef(data) {\n        if (typeof data !== 'object') {\n            return true\n        }\n        return data.__isRef\n    }\n\n    buildGetter() {\n        return (target, key) => {\n            const val = target[key]\n            console.log(val)\n            if (this.checkIfRef(val)) {\n                return target[key]\n            }\n            Reflect.set(target, key, this.subDef(val))\n            return target[key]\n        }\n    }\n\n    buildSetter() {\n        return (target, key, value) => {\n            Reflect.set(target, key, value)\n            this.render()\n        }\n    }\n\n    def(value) {\n        return new Proxy({ value }, {\n            get: this.buildGetter(),\n            set: this.buildSetter(),\n        })\n    }\n\n    subDef(target) {\n        target.__isRef = true\n        return new Proxy(target, {\n            get: this.buildGetter(),\n            set: this.buildSetter(),\n        })\n    }\n\n    getData(key) {\n        let getKey = `${key}.value`\n        if (key.includes('.')) {\n            const keyList = key.split('.')\n            getKey = keyList.slice(0, 1).concat(['value'], keyList.slice(1)).join('.')\n        }\n        const val = eval(`this.${getKey}`)\n        return val || ''\n    }\n\n    render() {\n        const { template } = this\n        const result = template.replace(/\\{\\{\\w+\\.?\\w+\\}\\}/g, (word) => {\n            const key = word.slice(2, word.length - 2)\n            return this.getData(key)\n        })\n        console.log('result', result)\n        this.$el.innerHTML = result\n    }\n}"],"names":["myVue","constructor","options","$el","getElement","el","template","innerHTML","data","activeMethods","methods","reactive","render","key","bind","name","includes","document","getElementById","slice","length","def","checkIfRef","__isRef","buildGetter","target","val","console","log","Reflect","set","subDef","buildSetter","value","Proxy","get","getData","getKey","keyList","split","concat","join","eval","result","replace","word"],"mappings":"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"}